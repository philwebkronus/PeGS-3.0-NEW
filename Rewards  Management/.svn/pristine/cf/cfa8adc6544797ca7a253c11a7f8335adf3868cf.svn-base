<?php

class ItemRedemptionLogsModel extends CFormModel
{
    
    public function updateItemRedemptionLogs($rewarditemid, $cashiername, $branchdetails, $remarks, $mid, $aid){

            $connection = Yii::app()->db;
            $date = date("Y-m-d H:i:s"); 
            $sql="UPDATE itemredemptionlogs SET CashierName = :cashiername, BranchDetails = :branchdetails,
                Remarks = :remarks, Status = 3, DateClaimed = :date, ClaimedByAID = :aid WHERE RewardItemID = :rewarditemid AND MID = :mid";
            $command = $connection->createCommand($sql);
            $command->bindValue(':cashiername', $cashiername);
            $command->bindValue(':branchdetails', $branchdetails);
            $command->bindValue(':remarks', $remarks);
            $command->bindValue(':mid', $mid);
            $command->bindValue(':date', $date);
            $command->bindValue(':aid', $aid);
            $command->bindValue(':rewarditemid', $rewarditemid);
            $result = $command->execute();

            return $result;

        }
        
        
    public function checkSerialSecCodes($serial, $security, $rewarditemid){
        
        $connection = Yii::app()->db;
         
        $sql="SELECT MID, RewardItemID, SecurityCode, SerialCode, ValidDateFrom, ValidDateTo, Status, Source FROM itemredemptionlogs 
            WHERE SerialCode = :serial AND SecurityCode = :security AND RewardItemID = :rewarditemid;";
        $command = $connection->createCommand($sql);
        $command->bindValue(':serial', $serial);
        $command->bindValue(':security', $security);
        $command->bindValue(':rewarditemid', $rewarditemid);
        $result = $command->queryAll();
         
        return $result;
        
    }    
    
 }
?>
